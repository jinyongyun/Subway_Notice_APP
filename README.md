# Subway_Notice_APP
ì§€í•˜ì²  ë„ì°© ì •ë³´ ì•± ë§Œë“¤ê¸° ğŸšŠ

## ë¹„ë™ê¸° ì²˜ë¦¬ ì•Œì•„ë³´ê¸°

ê·¸ë ‡ë‹¤ ìš°ë¦¬ê°€ ìë°”ì—ì„œ ë§ì´ ì‚¬ìš©í–ˆë˜ ë™ê¸°ì™€ ë¹„ë™ê¸°! 

ì˜¤ëŠ˜ì€ ì„œë²„ í†µì‹ ì´ ìˆë‹¤ ë³´ë‹ˆ ê·¸ë…€ì„ì— ëŒ€í•´ ì •ë¦¬í•´ë³´ë ¤ê³  í•œë‹¤.

ìš°ë¦¬ê°€ í† ìš”ì¼ ì•„ì¹¨ì— ì§‘ì•ˆì¼ì„ í•œë‹¤ê³  í•´ë³´ì.

**ì²­ì†Œê¸°ë¥¼ ëŒë¦¬ê³  â†’ ë¶€ëª¨ë‹˜ê»˜ ì „í™”ë¥¼ í•˜ê³  â†’ ë¹¨ë˜ë¥¼ í•œë‹¤**

í•˜ë‚˜ì˜ ì¼ì„ ëë‚œë’¤, ìˆœì„œëŒ€ë¡œ ì§„í–‰í•œë‹¤ë©´ ìš°ë¦¬ëŠ” ì´ê±¸ ë™ê¸°ë¼ê³  í•œë‹¤.

í•˜ì§€ë§Œ ë§Œì•½ ìš°ë¦¬ê°€

**ë¡œë´‡ì²­ì†Œê¸°ë¥¼ ëŒë¦¬ë©´ì„œ**

**ë¶€ëª¨ë‹˜ê»˜ ì „í™”ë¥¼ í•˜ë©´ì„œ**

**ë¹¨ë˜ë¥¼ í•œë‹¤ë©´**

ì´ì²˜ëŸ¼ ë³‘ë ¬ì ìœ¼ë¡œ ì¼ì´ ì§„í–‰ë˜ëŠ” ê²ƒì´ ë°”ë¡œ ë¹„ë™ê¸° ë°©ì‹ì´ë‹¤.

 ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ê°€ì¥ ë§ì´ í–‰í•´ì§€ëŠ” ë•Œê°€ ì„œë²„ì™€ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì´ ìˆì„ ë•Œë‹¤!

ìš°ë¦¬ê°€ GET ë©”ì„œë“œ ë°©ì‹ìœ¼ë¡œ ì„œë²„ì— ì–´ë–¤ ì •ë³´ë¥¼ ìš”ì²­í–ˆì„ ë•Œ

ë°ì´í„°ì™€ .success ë“±ì˜ ìƒíƒœê°’ì´ ë‚ ì•„ì˜¤ê¸° ì „ê¹Œì§€ ìš°ë¦¬ëŠ” ê·¸ì € ë©í•˜ë‹ˆ ìˆì„ ìˆœ ì—†ë‹¤.

ë­”ê°€ ì• ë‹ˆë©”ì´ì…˜ë„ í‘œì‹œí•´ì•¼í•˜ê³ , ë‹¤ì–‘í•œ ë™ì‘ì„ ì•±ì€ ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ìˆ˜í–‰í•˜ê³  ìˆì–´ì•¼ í•œë‹¤.

ì´ë¥¼ ìœ„í•´ì„œëŠ” ê¸°ë‹¤ë¦¬ë©´ì„œ ***ë™ì‹œì—***  ì–´ë–¤ ì¼ì„ ì§„í–‰í•´ì•¼ í•˜ë‹ˆ ë¹„ë™ê¸°ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤!

iOSì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ì´ 5ê°€ì§€ê°€ ìˆë‹¤.

- Notification Center
- Delegate Pattern
- Closure
- RxSwift
- Combine

ì´ë²ˆ ì•±ì—ì„œëŠ” ë„ì°© ì •ë³´ APIë¥¼ request í•  ë•Œ, ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•´ closureë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì´ë‹¤.

ì´ë²ˆì—ëŠ” ì§€í•˜ì²  ì—­ì„ ê²€ìƒ‰í•˜ê³  í•´ë‹¹ ì§€í•˜ì²  ì—­ì˜ ì‹¤ì‹œê°„ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ”

ì§€í•˜ì²  ë„ì°© ì •ë³´ ì•±ì„ ë§Œë“¤ì–´ë³´ê² ë‹¤.

ì¼ë‹¨ ì´ë²ˆ ì•±ì„ ë§Œë“¤ë©´ì„œ ì‚¬ìš©í•˜ê²Œ ë  ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” SnapKitê³¼ Alamofireê°€ ìˆë‹¤.

SnapKitì—ì„œ ëˆˆì¹˜ì±Œ ìˆ˜ ìˆë“¯ì´, ì´ë²ˆì—ë„ storyboard ì—†ì´ ì˜¤ì§ ì½”ë“œë§Œìœ¼ë¡œ UIë¥¼ êµ¬ì„±í•´ë³´ê³ ì í•œë‹¤.

êµ³ì´ pod íŒŒì¼ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  package managerë¥¼ ì´ìš©í•´ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•  ì˜ˆì •ì´ë‹¤.

Xcode í”„ë¡œì íŠ¸ ìƒì„± â†’ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ â†’ main.storyboard ì„¤ì¹˜

ì´ ê³¼ì •ì€ ì´ì œ ìµìˆ™í•´ì¡Œìœ¼ë¦¬ë¼ ìƒê°í•œë‹¤.

<img width="274" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-22 á„‹á…©á„’á…® 6 39 56" src="https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/4ac8b0fc-cf34-4e09-8e68-2689843c401e">


File > Add Package Dependencyë¡œ almofireì™€ snapKitì„ ì„¤ì¹˜í•œë‹¤.

main.storyboardë¥¼ ì‚­ì œí•˜ê³ . info.plistì™€ ì„¤ì •ì— ë‚¨ì•„ìˆëŠ” main ê´€ë ¨ ì •ë³´ë¥¼ ì§€ì›Œì¤€ë‹¤.
<img width="887" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-22 á„‹á…©á„’á…® 6 42 26" src="https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/e8627b50-4be4-435f-abab-2535ea22422d">

ì´ì œ SceneDelegateë¡œ ê°€ì„œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë©”ì„œë“œë¥¼ ì§€ìš°ê³ , 

windowë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ê±¸ ì‚¬ìš©í•´ì„œ, ìƒˆë¡­ê²Œ viewControllerë¥¼ ë² ì´ìŠ¤ë¡œ í•˜ëŠ” Sceneì„ ë§Œë“¤ì–´ì¤€ë‹¤.

```swift
//  SceneDelegate.swift
//  SubwayNotice
//
//  Created by jinyong yun on 1/22/24.
//

import UIKit

class SceneDelegate: UIResponder, UIWindowSceneDelegate {

    var window: UIWindow?

    func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
        guard let windowScene = (scene as? UIWindowScene) else { return }
        
        window = UIWindow(windowScene: windowScene)
        window?.backgroundColor = .systemBackground
        window?.rootViewController = ViewController()
        window?.makeKeyAndVisible() //ì´ê±° ë¹ ëœ¨ë¦¬ì§€ ë§ë¼ê³  í–ˆì§€!! ì´ê±° í•´ì•¼ ì ìš©ë¨
    }
}
```

## ì§€í•˜ì²  ê²€ìƒ‰ í™”ë©´ êµ¬í˜„í•˜ê¸°

ì§€í•˜ì²  ê²€ìƒ‰í™”ë©´ì˜ íë¦„ì„ ê·¸ë ¤ë³´ì.

ë¨¼ì € ìœ ì €ê°€ ì§€í•˜ì²  ë„ì°© ì •ë³´ í™”ë©´ì— ê²€ìƒ‰ì°½ì„ í´ë¦­í•˜ë©´, ê²€ìƒ‰ì°½ì— ì…ë ¥ëœ ê°’ì„ ìë™ì™„ì„± í•˜ê¸° ìœ„í•œ 

UITableViewê°€ í‘œì‹œëœë‹¤. (ì–´ë””ì—¬ ì•±ì—ì„œ ê²½í—˜í•´ë´¤ë‹¤!)

ìœ ì €ê°€ ê²€ìƒ‰ì°½ì— í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ê²Œ ë˜ë©´, ê²€ìƒ‰ì°½ì— ì…ë ¥ëœ ê°’ì— ë§ëŠ” ì§€í•˜ì²  ì—­ ì´ë¦„ì— ë§ëŠ” ìë™ ì™„ì„± ê²°ê³¼ë¥¼ ì„œë²„ì— ìš”ì²­í•œë‹¤.

ê·¸ë ‡ê²Œ ì„œë²„ì—ì„œ ë°›ì€ ì§€í•˜ì²  ê²€ìƒ‰ ê²°ê³¼ë¥¼ UITableViewì˜ cellì— í‘œì‹œí•˜ê²Œ ëœë‹¤.

ê²€ìƒ‰ì°½ì„ ë‹«ìœ¼ë©´(Cancel) ê²€ìƒ‰ ê²°ê³¼ê°€ ì´ˆê¸°í™” ë˜ì–´ì•¼ í•œë‹¤.

ì´ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ ë­ê°€ í•„ìš”í• ê¹Œ?

ë¨¼ì € UISearchControllerê°€ í•„ìš”í•˜ë‹¤. ì–´ë””ì—¬ ì•±ì—ì„œëŠ” viewControllerì— searchBarì™€ tableViewë¥¼ ì—°ê²°ì‹œí‚¤ê³ , ë¸ë¦¬ê²Œì´íŠ¸ë¡œ êµ¬í˜„í–ˆëŠ”ë°

ì´ë²ˆì—ëŠ” **UISearchController(+UITableView)**ë¼ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‚¬ìš©í•œë‹¤!

UISearchControllerëŠ” UIKitì˜ UI ì»´í¬ë„ŒíŠ¸ ì¤‘ í•˜ë‚˜ë¡œ UINavigationItemì— ì¶”ê°€í•´ì„œ ì‚¬ìš©í•  ì˜ˆì •ì´ë‹¤.

(UISearchControllerì•ˆì— ì´ë¯¸ UISearchBar ìˆë‹¤. UISearchControllerì—ëŠ” cancel ë²„íŠ¼ì´ë¼ë˜ê°€ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì´ í¬í•¨ë˜ì–´ìˆì–´ ì–´ë””ì—¬ì—ì„œ í–ˆë˜ ë°©ì‹ë³´ë‹¤ ë” ë¹ ë¥´ê³  í¸ë¦¬í•˜ë‹¤.)

 ë¬¼ë¡  UITableViewëŠ” í¬í•¨ë˜ì–´ ìˆì§€ ì•Šì•„ì„œ ishiddenì„ ì´ìš©í•´ì„œ ì²˜ë¦¬í•´ì¤˜ì•¼ í•œë‹¤. ğŸ¤¦ğŸ»

ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì.

ê¸°ì¡´ì— viewControllerë¥¼ StationSearchViewControllerë¡œ rename í•´ì¤¬ë‹¤.

SceneDelegateì—ì„œë„ 

```swift
window?.rootViewController = UINavigationController(rootViewController: StationSearchViewController())
```

ë£¨íŠ¸ ë·° ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì •í•´ì¤¬ë˜ ë¶€ë¶„ì„ ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¿”ì£¼ì. ë„¤ë¹„ê²Œì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë¼ì›Œì¤€ ê²ƒì´ë‹¤.

```swift
//  StationSearchViewController.swift
//  SubwayNotice
//
//  Created by jinyong yun on 1/22/24.
//

import SnapKit
import UIKit

class StationSearchViewController: UIViewController {

    override func viewDidLoad() {
        super.viewDidLoad()
        
        navigationController?.navigationBar.prefersLargeTitles = true
        navigationItem.title = "ì§€í•˜ì²  ë„ì°© ì •ë³´ ğŸš‡"

        //ê²€ìƒ‰ ê¸°ëŠ¥ì„ ìœ„í•´ ë°˜ë“œì‹œ í•„ìš”í•œ UISearchController ì¶”ê°€
        let searchController = UISearchController()
        searchController.searchBar.placeholder = "ì§€í•˜ì²  ì—­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" //ì„œì¹˜ë°”ì˜ placeholder ì„¤ì •
        searchController.obscuresBackgroundDuringPresentation = false // TODO
        
        navigationItem.searchController = searchController
    }

}
```

ì ì¼ë‹¨ ì—¬ê¸°ê¹Œì§€ ì‘ì„±í–ˆë‹¤. í™”ë©´ ë§¨ ìœ„ì— í° ì œëª©ì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ ë„¤ë¹„ê²Œì´ì…˜ ë°”ì— prefersLargeTitlesë¥¼ trueë¡œ ì„¤ì •í–ˆë‹¤.

ì œì¼ ì¤‘ìš”í•œ UISearchController()ì˜ ê²½ìš° navigationItemì— ì´ë¯¸ searchControllerë¼ëŠ” í”„ë¡œí¼í‹°ê°€ ìˆì–´ì„œ ì—¬ê¸°ì— ë„£ì–´ì£¼ë©´ ëœë‹¤!

![simulator_screenshot_7EEF57EF-7183-4964-BFC5-AD4CC6261782](https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/a9c459d2-e45a-48ab-b1a9-b1a87bef9163)


ì—¬ê¸°ê¹Œì§€ ë”°ë¼ì™”ë‹¤ë©´, ë‹¤ìŒê³¼ ê°™ì´ í™”ë©´ì´ ë‚˜íƒ€ë‚  ê²ƒì´ë‹¤!

obscuresBackgroundDuringPresentation â†’ ì´ê²Œ ë­¡ë‹ˆê¹Œ?

ë…íŠ¹í•œ ë…€ì„ì´ ë¼ì–´ìˆëŠ”ë°, ì´ë…€ì„ì€ searchBarë¥¼ í´ë¦­í–ˆì„ ë•Œ, falseë©´ ë°‘ì— í™”ë©´ì´ ë°±ê·¸ë¼ìš´ë“œ ìƒ‰ìƒìœ¼ë¡œ ë³´ì´ê³ , trueë©´ ì•½ê°„ ë¶ˆíˆ¬ëª…í•œ íšŒìƒ‰ìœ¼ë¡œ ë³´ì¸ë‹¤.

<img width="485" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-22 á„‹á…©á„’á…® 7 28 26" src="https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/75e6a56f-d8cf-4cb4-ab4d-b65d8939bd44">


obscuresBackgroundDuringPresentation

= false

<img width="478" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-22 á„‹á…©á„’á…® 7 30 08" src="https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/d0176fcb-d478-4f21-ae3d-a91ac32b1d08">


obscuresBackgroundDuringPresentation

= true

ìš°ë¦¬ëŠ” searchBar ë°‘ì— í…Œì´ë¸” ë·°ë¥¼ ì‘ì„±í•´ì•¼ í•´ì„œ, falseë¥¼ ì¤¬ë‹¤.

```swift
//  StationSearchViewController.swift
//  SubwayNotice
//
//  Created by jinyong yun on 1/22/24.
//

import SnapKit
import UIKit

class StationSearchViewController: UIViewController {
    
    private lazy var tableView: UITableView = {
        let tableView = UITableView()
        tableView.dataSource = self
        return tableView
    }()
    

    override func viewDidLoad() {
        super.viewDidLoad()
        
        navigationController?.navigationBar.prefersLargeTitles = true
        navigationItem.title = "ì§€í•˜ì²  ë„ì°© ì •ë³´ ğŸš‡"

        //ê²€ìƒ‰ ê¸°ëŠ¥ì„ ìœ„í•´ ë°˜ë“œì‹œ í•„ìš”í•œ UISearchController ì¶”ê°€
        let searchController = UISearchController()
        searchController.searchBar.placeholder = "ì§€í•˜ì²  ì—­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" //ì„œì¹˜ë°”ì˜ placeholder ì„¤ì •
        searchController.obscuresBackgroundDuringPresentation = false // TODO
        
        navigationItem.searchController = searchController
    }

    
}

extension StationSearchViewController: UITableViewDataSource {
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return 10 //ì„ì˜ ì„¤ì •
    }
    
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = UITableViewCell()
        cell.textLabel?.text = "\(indexPath.item)"
        return cell
    }
    
    
}
```

ë‹¤ìŒìœ¼ë¡œëŠ” lazy varë¡œ tableViewë¥¼ ì„ ì–¸í–ˆë‹¤.

lazyë¡œ ì„¤ì •í•œ ì´ìœ ëŠ” ê³µì‹ë¬¸ì„œì—ì„œ ê·¸ë ‡ê²Œ í•˜ë¼ê³  ì¶”ì²œí•˜ê¸°ë„ í–ˆê³ , 

êµ³ì´ ë©”ëª¨ë¦¬ì— ë¯¸ë¦¬ ì˜¬ë ¤ë†“ì„ í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. 

í…Œì´ë¸” ë·°ë¥¼ í´ë¡œì € í˜•ì‹ìœ¼ë¡œ ì •ì˜í–ˆëŠ”ë°, ì•ˆì— dataSourceë„ ê°™ì´ ì§€ì •í•´ì¤¬ë‹¤.

dataSourceëŠ” ë”°ë¡œ extensionìœ¼ë¡œ ë¹¼ì¤˜ì„œ, ì•ˆì— numberOfRowsInSectionê³¼ cellForRowAtì„ êµ¬í˜„í•´ì¤¬ë‹¤. numberOfRowInSectionì—ì„œ ì„ì˜ë¡œ 10ê°œì˜ ì…€ì„ ë³´ì—¬ì£¼ë„ë¡ ì„¤ì •í–ˆê³ , cellForRowAtì—ì„œ ì´ë²ˆì—ëŠ” êµ³ì´ ì»¤ìŠ¤í…€ ì…€ì„ ë§Œë“¤ì§€ ì•Šê¸° ë•Œë¬¸ì—, ê¸°ë³¸ ì…€ì„ ë¦¬í„´í•´ì¤¬ë‹¤.

ì´ì œ ë ˆì´ì•„ì›ƒì„ ì„¤ì •í•´ë³´ì.

viewDidLoadê°€ ë„ˆë¬´ ëš±ëš±í•´ì§ˆê¹Œë´ ë”°ë¡œ ë©”ì„œë“œë¡œ ë¹¼ì¤¬ë‹¤.

```swift
override func viewDidLoad() {
        super.viewDidLoad()
        setNavigationItems()
        setTableViewLayout()
    }
    
    private func setNavigationItems() {
        navigationController?.navigationBar.prefersLargeTitles = true
        navigationItem.title = "ì§€í•˜ì²  ë„ì°© ì •ë³´ ğŸš‡"

        //ê²€ìƒ‰ ê¸°ëŠ¥ì„ ìœ„í•´ ë°˜ë“œì‹œ í•„ìš”í•œ UISearchController ì¶”ê°€
        let searchController = UISearchController()
        searchController.searchBar.placeholder = "ì§€í•˜ì²  ì—­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" //ì„œì¹˜ë°”ì˜ placeholder ì„¤ì •
        searchController.obscuresBackgroundDuringPresentation = false // TODO
        
        navigationItem.searchController = searchController
    }

    private func setTableViewLayout() {
        view.addSubview(tableView)
        tableView.snp.makeConstraints { $0.edges.equalToSuperview() } //ì „ì²´ UIViewControllerì— ë”± ë§ê²Œ!
    }
```

![simulator_screenshot_90487969-17FC-42D2-AC61-6D7964AB62AA](https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/d5305d17-0924-47b9-b5f9-fd6e1a5fe24e)


ì˜ ë‚˜ì™”ì§€ë§Œ, searchBarì— ì»¤ì„œê°€ ìˆì„ ë•Œë§Œ í…Œì´ë¸” ë·°ê°€ ë‚˜íƒ€ë‚˜ì•¼ í•œë‹¤.

ì§€ê¸ˆì€ ëŠ˜ í‘œì‹œëœë‹¤.

ì»¤ì„œì˜ ìœ ë¬´ì— ë”°ë¼ í…Œì´ë¸” ë·°ë¥¼ í‘œì‹œì‹œì¼œë³´ì.

UISearchBarDelegateë¡œ êµ¬í˜„í•  ìˆ˜ ìˆê³ , 

searchController.searchBar.delegate = **selfë¥¼ ë‹¹ì—°íˆ searchControllerë¥¼ ì„¤ì •í•˜ëŠ” ë¶€ë¶„, ì¦‰ setNavigationItems ë©”ì„œë“œì— ì¶”ê°€í•´ì•¼í•œë‹¤.**

```swift
extension StationSearchViewController: UISearchBarDelegate {
    func searchBarTextDidBeginEditing(_ searchBar: UISearchBar) {
        tableView.isHidden = false
    }
    
    func searchBarTextDidEndEditing(_ searchBar: UISearchBar) {
        tableView.isHidden = true
    }
}
```

UISearchBarDelegateì—ì„œ êµ¬í˜„í•´ì•¼ í•˜ëŠ” í•¨ìˆ˜ëŠ” searchBarTextDidBeginEditingê³¼ 

searchBarTextDidEndEditingì´ë‹¤.

êµ‰ì¥íˆ ì§ê´€ì ì¸ ì´ë¦„ì²˜ëŸ¼ text ì…ë ¥ì´ ì‹œì‘ë  ë•Œì™€ ëë‚  ë•Œ ì‹¤í–‰ë˜ëŠ” ë©”ì„œë“œì´ë‹¤.

tableView.isHidden = **true ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì£¼ëŠ” ê±¸ ìŠì§€ ë§ì!**

ì•„ë§ˆ ì‹¤í–‰ì‹œì¼œë³´ë©´ ì„œì¹˜ë°”ê°€ ì•ˆë³´ì¼í…ë° ë‹¹í™©í•˜ì§€ ë§ê³  ì•„ë˜ë¡œ í™”ë©´ì„ ì•½ê°„ ë‚´ë ¤ë³´ë©´ ë‚˜ì˜¨ë‹¤.

ì™œ ì´ë ‡ê²Œ ë˜ëƒë©´, ìš°ë¦¬ê°€ numberOfRowsInSectionì—ì„œ ë³´ì—¬ì§ˆ ì…€ì˜ ê°œìˆ˜ë¥¼ 10ê°œë¡œ ì„¤ì •í•´ì„œ ê·¸ë ‡ë‹¤. 

ì„œì¹˜ë°”ì™€ í…Œì´ë¸” ë·°ì˜ ìƒê´€ê´€ê³„ê°€ ì–´ëŠì •ë„ ìˆì–´ì„œ ì´ëŸ° ê¸°ì´í•œ í˜„ìƒì´ ë°œìƒí•œë‹¤.

**private** **var** numberOfCell: Int = 0

ì´ë ‡ê²Œ ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì£¼ê³  

numberOfRowsInSectionì—ì„œ ì´ê±¸ ë¦¬í„´í•´ì£¼ë©´ ì˜ ë³´ì¸ë‹¤.  0ìœ¼ë¡œ ê³„ì† ì´ˆê¸°í™”ë¥¼ ì‹œì¼œì£¼ì§€ë§Œ, ì„œë²„ì—ì„œ ìë™ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°›ì•„ì˜¤ê¸° ì „ê¹Œì§€ë§Œ ì´ë ‡ê²Œ ì„¤ì •í•´ì£¼ëŠ” ê²ƒì´ë‹¤.

```swift
extension StationSearchViewController: UISearchBarDelegate {
    func searchBarTextDidBeginEditing(_ searchBar: UISearchBar) {
        numberOfCell = 10
        tableView.isHidden = false
    }
    
    func searchBarTextDidEndEditing(_ searchBar: UISearchBar) {
        numberOfCell = 0
        tableView.isHidden = true
    }
}
```

ì—¬ê¸°ë„ ì„ì‹œì ìœ¼ë¡œ ë³´ì—¬ì§ˆ ë•Œ ì…€ ê°œìˆ˜ë¥¼ 10ê°œë¡œ í•˜ê³ , ì‘ì„± ëë‚˜ë©´ 0ê°œë¡œ ë‹¤ì‹œ ë§Œë“¤ì–´ì£¼ë„ë¡ í•´ì¤¬ë‹¤.



https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/2a701e0b-db94-448e-94ff-5c7e2abc7ba6



## ë„ì°© ì •ë³´ í™”ë©´ êµ¬í˜„í•˜ê¸°

ìš°ë¦¬ê°€ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ë„ì°© ì •ë³´ í™”ë©´ì˜ í”Œë¡œìš°ë¥¼ ì‚´í´ë³´ì.

searchBar ë°‘ì— êµ¬í˜„ëœ í…Œì´ë¸” ë·° ì…€ì„ í´ë¦­í•˜ë©´, í•´ë‹¹ ì§€í•˜ì²  ì—­ì— ì§€í•˜ì²  ë„ì°© ì •ë³´ê°€ CollectionView í˜•íƒœ(í…Œì´ë¸” ë·°ë‘ ë¹„ìŠ·í•˜ê²Œ)ë¡œ ë‚˜íƒ€ë‚˜ëŠ” ê²ƒì„ ì›í•œë‹¤.

ì´ ì»¬ë ‰ì…˜ ë·°ë¥¼ ë°‘ìœ¼ë¡œ ë‚´ë¦¬ë©´ ìƒˆë¡œìš´ ì •ë³´ê°€ ì—…ë°ì´íŠ¸ ëœë‹¤.

ê°€ì¥ ë¨¼ì € êµ¬í˜„í•´ì•¼ í•˜ëŠ” ê¸°ëŠ¥ì€ í…Œì´ë¸” ë·° ì…€ì„ ì„ íƒí–ˆì„ ë•Œ ë„ì°© ì •ë³´ í™”ë©´ì´ ë‚˜íƒ€ë‚˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤.

ì¼ë‹¨ ìƒì„¸ ë„ì°© ì •ë³´ í™”ë©´ì´ ë‚˜íƒ€ë‚  ë·° ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë¨¼ì € ë§Œë“¤ì—ˆë‹¤.

StationDetailViewControllerë¡œ ì´ë¦„ì§€ì–´ì¤¬ë‹¤.

ê·¸ë¦¬ê³  StationSearchViewControllerì—ì„œ ì…€ì„ ëˆŒë €ì„ ë•Œ í•´ë‹¹ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ë„ë¡ ì„¤ì •í•´ì¤˜ì•¼ í•œë‹¤.

UITableViewDelegateê°€ í•„ìš”í•˜ë‹ˆ, extensionìœ¼ë¡œ ë¹¼ì£¼ê³  tableView í´ë¡œì € ë‚´ë¶€ì—ì„œ delegateë¥¼ ë§¤í•‘í•´ì¤¬ë‹¤.

```swift
extension StationSearchViewController: UITableViewDelegate {
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        let vc = StationDetailViewController()
        navigationController?.pushViewController(vc, animated: true)
    }
    
}
```

ê·¸ë¦¬ê³  UITableViewDelegateì—ì„œëŠ” didSelectRowAtë¥¼ ì‘ì„±í•´ì¤¬ë‹¤.

í´ë¦­í–ˆì„ ë•Œ í™”ë©´ì „í™˜ì´ ë˜ë„ë¡ pushViewController ë©”ì„œë“œë¥¼ ì´ìš©í–ˆë‹¤.

ì•„ ê·¸ë¦¬ê³  ì„œì¹˜ë°” í´ë¦­ ì‹œ ***í…Œì´ë¸” ë·°ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ” ë¬¸ì œ***ê°€ ìˆì—ˆëŠ”ë°

ë‹¨ì§€ ë¦¬ë¡œë“œë¥¼ ì•ˆí•´ì¤˜ì„œ ê·¸ë ‡ë‹¤.

searchBarTextDidBeginEditingì—ì„œ numberOfCell=10ìœ¼ë¡œ ì„¤ì •í•´ì¤€ ë°‘ì— 

tableView.reloadData()

í•´ì£¼ë©´ ë‹¤ì‹œ ë‚˜ì˜¨ë‹¤!



https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/1b4398cf-7c71-40c2-ab79-be683d38c9c4



ì´ì œ StationDetailViewControllerë¡œ ëŒì•„ê°€ì„œ

ì•„ì§ ì…€ì— ì„œë²„ë¡œë¶€í„° ì •ë³´ë¥¼ ë°›ì•„ì™€ ë°˜ì˜í•˜ì§€ ëª»í–ˆê¸° ë•Œë¬¸ì—

navigationItem.titleì„ ì„ì‹œì ìœ¼ë¡œ ì„¤ì •í•´ì¤¬ë‹¤.

collectionViewë¥¼ ë¨¼ì € ì •ì˜í•´ì„œ, í´ë¡œì € í˜•íƒœë¡œ UICollectionViewFlowLayoutë„ ë§Œë“¤ì–´ì£¼ê³ 

ëŒ€ì¶© í¬ê¸°ë„ ì¡ì•„ì£¼ê³ (ì–‘ìª½ 16ì •ë„ ë„ê³ , marginë„ ì„¤ì •), ìŠ¤í¬ë¡¤ ë°©í–¥ë„ ì„¤ì •í–ˆë‹¤.

ì…€ì„ ì„ì‹œì ìœ¼ë¡œ ë“±ë¡í•´ì£¼ê³  dataSourceë„ ì„¤ì •í–ˆë‹¤.

ê·¸ëŸ¬ë‹ˆ dataSourceë¥¼ extensionìœ¼ë¡œ ë¹¼ì„œ êµ¬í˜„í•´ì¤˜ì•¼ í•œë‹¤.

numberOfItemsInSectionì€ ì¼ë‹¨ 3ì„ ë¦¬í„´í•˜ë„ë¡ í•´ì¤¬ê³ , 

cellForItemAtì—ì„œëŠ” êµ¬í˜„í•  ì»¤ìŠ¤í…€ ì…€ì„ ë¨¼ì € ì…ë ¥í•´ì¤¬ë‹¤. ê·¸ë¦¬ê³  ë¯¸ë¦¬ ì•Œì•„ë³¼ ìˆ˜ ìˆê²Œ .gray ìƒ‰ìƒì„ ë°”íƒ•ì— ì£¼ì—ˆë‹¤. 

```swift
//
//  StationDetailViewController.swift
//  SubwayNotice
//
//  Created by jinyong yun on 1/22/24.
//

import SnapKit
import UIKit

final class StationDetailViewController: UIViewController {
    
    
    private lazy var collectionView: UICollectionView = {
        let layout = UICollectionViewFlowLayout()
        layout.estimatedItemSize = CGSize(width: view.frame.width-32.0, height: 100.0)
        layout.sectionInset = UIEdgeInsets(top: 16.0, left: 16.0, bottom: 16.0, right: 16.0)
        layout.scrollDirection = .vertical
        
        let collectionView = UICollectionView(frame: .zero, collectionViewLayout: layout)
        collectionView.backgroundColor = .systemBackground
        collectionView.register(UICollectionViewCell.self, forCellWithReuseIdentifier: "StationDetailCollectionViewCell")
       
        collectionView.dataSource = self
        
        return collectionView
    }()
    
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        navigationItem.title = "ì™•ì‹­ë¦¬" //ì„ì‹œ ì„¤ì •
        
        view.addSubview(collectionView)
        collectionView.snp.makeConstraints { $0.edges.equalToSuperview() }
    }
    
}

extension StationDetailViewController: UICollectionViewDataSource {
    
    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {
        return 3
    }
    
    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: "StationDetailCollectionViewCell", for: indexPath)
        
        cell.backgroundColor = .gray
        return cell
    }
    
}
```

![simulator_screenshot_B528C2E0-65C1-4B32-9658-568B627E7155](https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/9f823476-db14-485d-8f67-887b2ae68c4d)


ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰ì‹œì¼œë³´ë©´

ì—„ì²­ íˆ¬ë°•í•œ í™”ë©´ì´ ë‚˜ì˜¨ë‹¤â€¦.

ì´ ì—­ì‹œ ìš°ë¦¬ê°€ ë°”ë¼ëŠ” UIì™€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— 

ì»¤ìŠ¤í…€ ì…€ì„ ìƒì„±í•´ì£¼ê³ , ëª‡ ê°€ì§€ ë ˆì´ì•„ì›ƒì„ ì¶”ê°€í•´ì¤˜ì•¼ê² ë‹¤.

ìœ„ì—ì„œ ë¯¸ë¦¬ ì •ì˜í•œ ëŒ€ë¡œ StationDetailCollectionViewCell íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.

```swift
//  StationDetailCollectionViewCell.swift
//  SubwayNotice
//
//  Created by jinyong yun on 1/23/24.
//

import SnapKit
import UIKit

class StationDetailCollectionViewCell: UICollectionViewCell {
    func setup() {
        backgroundColor = .gray
        
    }
    
    
}
```

ê·¸ëŸ¼ ê¸°ì¡´ì— StationDetailViewControllerì—ì„œ ì„ì‹œì ìœ¼ë¡œ ì¼ë°˜ UICollectionViewCellì„ ë¦¬í„´í•´ì¤¬ë˜ ë¶€ë¶„ì„ ê³ ì¹  ìˆ˜ ìˆë‹¤.

```swift
collectionView.register(StationDetailCollectionViewCell.self, forCellWithReuseIdentifier: "StationDetailCollectionViewCell")

...

func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: "StationDetailCollectionViewCell", for: indexPath) as? StationDetailCollectionViewCell
        
        cell?.setup()
        
        return cell ?? UICollectionViewCell()
    }
```

í•´ë‹¹ ë©”ì„œë“œë“¤ì„ ìˆ˜ì •í•œë‹¤.

ì»¤ìŠ¤í…€ ì…€ê³¼ CollectionViewë¥¼ ì—°ê²°í–ˆìœ¼ë‹ˆ, ì´ì œ ì»¤ìŠ¤í…€ ì…€ì„ ê¾¸ë©°ë³´ë„ë¡ í•˜ì

```swift
//
//  StationDetailCollectionViewCell.swift
//  SubwayNotice
//
//  Created by jinyong yun on 1/23/24.
//

import SnapKit
import UIKit

class StationDetailCollectionViewCell: UICollectionViewCell {
    
    private lazy var lineLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 15.0, weight: .bold)

        return label
    }()
    
    private lazy var remainTimeLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 15.0, weight: .medium)
        
        return label
    }()
    
    
    func setup() {
        layer.cornerRadius = 12.0
        layer.shadowColor = UIColor.black.cgColor
        layer.shadowOpacity = 0.2
        layer.shadowRadius = 10

        backgroundColor = .systemBackground

        [lineLabel, remainTimeLabel].forEach { addSubview($0) }
        
        lineLabel.snp.makeConstraints {
            $0.leading.equalToSuperview().inset(16.0)
            $0.top.equalToSuperview().inset(16.0)
        }
        
        remainTimeLabel.snp.makeConstraints {
            $0.leading.equalTo(lineLabel)
            $0.top.equalTo(lineLabel.snp.bottom).offset(16.0)
            $0.bottom.equalToSuperview().inset(16.0)
        }
        
        lineLabel.text = "í•œì–‘ëŒ€ ë°©ë©´"
        remainTimeLabel.text = "ëšì„¬ ë„ì°©"
        
    }
    
    
}
```

![simulator_screenshot_11A6605A-C610-47F9-A78C-2B5D9E9158E3](https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/6e1a3ebb-f513-4620-b072-5b3cddba5f4a)


ì–´ëŠ ë°©ë©´ì¸ì§€ í‘œì‹œí•´ì£¼ëŠ” lineLabelê³¼ ëª‡ ë¶„ ë‚¨ì•˜ëŠ”ì§€ í‘œì‹œí•´ì£¼ëŠ” remainTimeLabelì„ ì •ì˜í•´ì¤¬ë‹¤.

cellForItemAtì—ì„œ í˜¸ì¶œí•´ì¤¬ë˜ setup()ì—ì„œ addSubview í•´ì£¼ê³  ê° ë¼ë²¨ì˜ ë ˆì´ì•„ì›ƒì„ ì§€ì •í•´ì¤¬ë‹¤.

ì„ì‹œì ìœ¼ë¡œ ë¼ë²¨ ê°’ì„ ë„£ì–´ì£¼ì–´ ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ì•Œì•„ë³¼ ìˆ˜ ìˆë„ë¡ í–ˆë‹¤.

setup ë¶€ë¶„ì—ì„œ ë ˆì´ì–´ë¥¼ ë§Œì ¸ì¤˜ì„œ 

ê±°ìŠ¬ë¦¬ë˜ UIë¥¼ ê¹”ë”í•˜ê²Œ ë°”ê¿”ì¤¬ë‹¤.

ì¼ë‹¨ ì»¬ë ‰ì…˜ ë·° UIê¹Œì§€ êµ¬í˜„í–ˆë‹¤. 

ì´ì–´ì„œ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ì„œ í™”ë©´ì— ë¿Œë ¤ì£¼ê³ , ìƒˆë¡œ ì—…ë°ì´íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ í™”ë©´ì„ ì•„ë˜ë¡œ ë‚´ë ¤ ë¦¬ë¡œë“œí•˜ëŠ” ë™ì‘ì„ êµ¬í˜„í•´ë³´ë ¤ í•œë‹¤.

ì—¬ê¸°ì„œ ì´ìš©í•´ ë³¼ ê²ƒì€ UIRefreshControlì´ë‹¤. [ë¨¸ë‹ˆë­ë‹ˆ] í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í–ˆë˜ ê¸°ì–µì´ ë‚œë‹¤.

UIRefreshControlì€ ë‹¨ë…ì ìœ¼ë¡œ ì‚¬ìš©ë˜ê¸° ë³´ë‹¤ëŠ” UICollectionViewì™€ ê°™ì´ ì–´ë”˜ê°€ì— ëŒ€ì…ë˜ì–´ì„œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ë¹ˆë²ˆí•˜ë‹¤.

êµ¬í˜„ì´ ë³µì¡í•˜ì§€ëŠ” ì•Šë‹¤. ì•¡ì…˜ ë©”ì„œë“œë§Œ êµ¬í˜„í•´ì£¼ë©´ ì‘ë™í•˜ëŠ” ì•„ì£¼ì•„ì£¼ í¸ë¦¬í•œ ë…€ì„ì´ë‹¤.

```swift
final class StationDetailViewController: UIViewController {
    private lazy var refreshControl: UIRefreshControl = {
       let refreshControl = UIRefreshControl()
        refreshControl.addTarget(self, action: #selector(fetchData), for: .valueChanged)
        return refreshControl
    }()
    
    @objc func fetchData(){
        print("Refresh data!")
        refreshControl.endRefreshing()
    }
    
    private lazy var collectionView: UICollectionView = {
         ...
        collectionView.refreshControl = refreshControl
         ...
    }()

...
```

ì´ëŸ°ì‹ìœ¼ë¡œ refreshControl í•˜ë‚˜ ë§Œë“¤ì–´ ì¤€ ë‹¤ìŒì—

ë²„íŠ¼ì²˜ëŸ¼ refreshControlì— ë§Œë“¤ì–´ ì¤€ fetchData() selectorë¥¼ addTarget í•´ì£¼ê³ 

ì´ê±¸ collectionViewì— ì´ë¯¸ ìˆëŠ” í”„ë¡œí¼í‹°ì¸ refreshControlì— ë„£ì–´ì£¼ë©´ ë!



https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/3591afe7-31fb-43ca-99d0-e8d2886d1d9b



## ì§€í•˜ì²  ë„ì°© ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë„¤íŠ¸ì›Œí¬ í†µì‹  êµ¬í˜„í•˜ê¸°

ì‚¬ìš©í•  APIëŠ” ëª¨ë‘ ì„œìš¸ ì—´ë¦° ê´‘ì¥ì˜ ê³µê³µ API ì‚¬ìš©í•œë‹¤.

ì§€í•˜ì²  ê²€ìƒ‰ì—ëŠ” ì§€í•˜ì²  ì—­ëª…ì„ ë°”íƒ•ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” API

[ì„œìš¸ì‹œ ì§€í•˜ì² ì—­ ì •ë³´ ê²€ìƒ‰ (ì—­ëª…)](https://data.seoul.go.kr/dataList/OA-121/S/1/datasetView.do)

[http://openAPI.seoul.go.kr:8088/(ì¸ì¦í‚¤)/xml/SearchInfoBySubwayNameService/1/5/ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›/](http://openapi.seoul.go.kr:8088/sample/xml/SearchInfoBySubwayNameService/1/5/%EB%8F%99%EB%8C%80%EB%AC%B8%EC%97%AD%EC%82%AC%EB%AC%B8%ED%99%94%EA%B3%B5%EC%9B%90/)

ìœ„ì—ëŠ” ìƒ˜í”Œ urlì¸ë° ì—­ ì´ë¦„ì„ ê°€ì¥ ë§ˆì§€ë§‰ì— ë‘ì–´ request í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ì¸ì¦í‚¤ê°€ ì›ë˜ í•„ìš”í•œë°, ìš°ë¦¬ëŠ” ìƒ˜í”Œ ì•±ì´ê¸° ë•Œë¬¸ì— ê·¸ëƒ¥ sampleì„ ë„£ì–´ ì§„í–‰í•˜ë©´ ëœë‹¤!

```swift
<?xml version="1.0" encoding="UTF-8"?>
<SearchInfoBySubwayNameService>
<list_total_count>3</list_total_count>
<RESULT>
<CODE>INFO-000</CODE>
<MESSAGE>ì •ìƒ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤</MESSAGE>
</RESULT>
<row>
<STATION_CD>0319</STATION_CD>
<STATION_NM>ì¢…ë¡œ3ê°€</STATION_NM>
<LINE_NUM>03í˜¸ì„ </LINE_NUM>
<FR_CODE>329</FR_CODE>
</row>
<row>
<STATION_CD>2535</STATION_CD>
<STATION_NM>ì¢…ë¡œ3ê°€</STATION_NM>
<LINE_NUM>05í˜¸ì„ </LINE_NUM>
<FR_CODE>534</FR_CODE>
</row>
<row>
<STATION_CD>0153</STATION_CD>
<STATION_NM>ì¢…ë¡œ3ê°€</STATION_NM>
<LINE_NUM>01í˜¸ì„ </LINE_NUM>
<FR_CODE>130</FR_CODE>
</row>
</SearchInfoBySubwayNameService>
```

ì˜ˆì œë¥¼ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ responseê°€ ë‚ ë¼ì˜¤ëŠ”ë°

ìš°ë¦¬ê°€ ì—¬ê¸°ì„œ í•„ìš”í•œ ê±´, row ì˜ì—­ì˜ valueì´ë‹¤.

ì´ë²ˆ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì— í•„ìš”í•œ ê±´ Alamofire + Codable ì´ë‹¤.

URLSessionì€ ì €ë²ˆì— í•´ë´¤ê¸°ì— ì´ë²ˆì—ëŠ” Alamofireë¥¼ ì„ íƒí–ˆë‹¤.

ìš°ì„  ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ìœ„í•´ info.plist ë¶€í„° ìˆ˜ì •í•´ì¤€ë‹¤.

ì•„ë˜ì˜ App Transport Security Settingsë¥¼ ì¶”ê°€í•´ì£¼ê³ 

í•˜ìœ„ ìš”ì†Œë¡œ Allow Arbitrary Loads ê°’ì„ YESë¡œ ë°”ê¿”ì¤€ë‹¤!
<img width="589" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-23 á„‹á…©á„Œá…¥á†« 10 34 04" src="https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/22b26308-3b87-499e-a948-4d52cdf08cb2">


ê·¸ë¦¬ê³  ìš°ë¦¬ê°€ í•„ìš”í•œ response ê°’ì„ Codableë¡œ ì •ì˜í•´ì£¼ë„ë¡ í•˜ì.

ê°œì¸ì ìœ¼ë¡œ ë³µì¡í•œ ëª¨ë¸ì„ ì •ì˜í•  ë• ê°€ì¥ í•˜ìœ„ë¶€í„° ë§Œë“œëŠ” ê²ƒì´ ì¡°ê¸ˆ í¸í•œ ê²ƒ ê°™ë‹¤.

```swift
//
//  StationResponseModel.swift
//  SubwayNotice
//
//  Created by jinyong yun on 1/23/24.
//

import Foundation

struct StationResponseModel: Decodable {
    
    var stations: [Station] { searchInfo.row }
    
    private let searchInfo: SearchInfoBySubwayNameServiceModel
    
    enum CodingKeys: String, CodingKey {
        case searchInfo = "SearchInfoBySubwayNameService"
    }
    
    struct SearchInfoBySubwayNameServiceModel: Decodable {
        var row: [Station] = []
        
    }
    
}

struct Station: Decodable {
    let stationName: String
    let lineNumber: String
    
    enum CodingKeys: String, CodingKey {
        case stationName = "STATION_NM"
        case lineNumber = "LINE_NUM"
    }
    
}
```

ì½”ë“œë¥¼ ì²œì²œíˆ ì‚´í´ë³´ë©´ ì´í•´í•  ìˆ˜ ìˆë‹¤! ëŒ€ëµì ì¸ êµ¬ì¡°ëŠ” SearchInfoBySubwayNameServiceModelì´ ìˆê³  ì´ ì•ˆì— Station ë°°ì—´ì´ ìˆëŠ” êµ¬ì¡°ì´ë‹¤. ì—¬ê¸°ì„œ SearchInfoBySubwayNameServiceModel íƒ€ì…ì¸ searchInfoë¥¼ privateìœ¼ë¡œ ìˆ¨ê¸°ê³  stationsë€ Station ë°°ì—´ì— ë°”ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ì¤˜ì„œ ì‚¬ìš©ìê°€ 

StationResponseModel().searchInfo.row

ì›ë˜ ì´ë ‡ê²Œ ì ‘ê·¼í•´ì•¼ í•˜ëŠ” ê±¸

StationResponseModel().stations

ì´ë ‡ê²Œ ì‰½ê²Œ ì ‘ê·¼í•˜ë„ë¡ í•´ì¤¬ë‹¤. ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê±¸ ë³´ì—¬ì£¼ê³ , ì›í•˜ì§€ ì•ŠëŠ” ê±¸ ìˆ¨ê¸°ëŠ” ê²Œ ìº¡ìŠí™” ì¦‰ privateì˜ ì¥ì ì´ ì•„ë‹ˆê² ëŠ”ê°€!

ëª¨ë¸ì„ ì™„ì„±í–ˆìœ¼ë‹ˆ ì´ì œ Alamofireë¥¼ ì‚¬ìš©í•´ ì‹¤ì§ˆì ìœ¼ë¡œ requestí•˜ëŠ” ë¶€ë¶„ì„ êµ¬í˜„í•´ë³´ë„ë¡ í•˜ì.

```swift
class StationSearchViewController: UIViewController {
    
...
    

    override func viewDidLoad() {
        super.viewDidLoad()
        setNavigationItems()
        setTableViewLayout()
        requestStationName()
    }
    
  ...

    private func requestStationName() {
        let urlString = "http://openapi.seoul.go.kr:8088/sample/json/SearchInfoBySubwayNameService/1/5/ì„œìš¸ì—­"        
        AF.request(urlString.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "")
            .responseDecodable(of: StationResponseModel.self) { response in
                guard case .success(let data) = response.result else {return}
                
                print(data.stations)
            }
            .resume()
        
    }
}
```

ìœ„ì™€ ê°™ì´ requestStationName ë©”ì„œë“œì—ì„œ ì¼ë‹¨ ì„œìš¸ì„ ê²€ìƒ‰í•´ë³´ë„ë¡ urlì„ êµ¬ì„±í–ˆë‹¤.

ê·¸ ë‹¤ìŒ AF.requestë¥¼ ì‚¬ìš©í•´ì„œ urlì„ ë„˜ê²¨ requestë¥¼ ë‚ ë¦¬ë„ë¡ í•´ì¤€ë‹¤.

ì´ë•Œ ì£¼ì˜í•´ì•¼ í•  ì ì´ ìš°ë¦¬ê°€ ì‘ì„±í•œ urlì—ì„œ ë§ˆì§€ë§‰ì— í•œê¸€ë¡œ â€œì„œìš¸â€ì´ë¼ê³  ë³´ë‚´ë©´

ì´ê²Œ ê¹¨ì ¸ì„œ íŠ¹ìˆ˜ë¬¸ìë¡œ ë³€í™˜ë˜ì–´ ì„œë²„ì— ì „ë‹¬ëœë‹¤.

ì„œë²„ì—ì„œ ë‹¤ì‹œ ì¡°í•©ëœë‹¤ í•˜ë”ë¼ë„ ì„œìš¸ì´ë€ ë‹¨ì–´ê°€ ì œëŒ€ë¡œ ì™„ì„±ë˜ì§€ ì•Šì„ í™•ë¥ ì´ ë†’ê¸° ë•Œë¬¸ì—

**urlString.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? ""**

êµ¬ë¬¸ì„ ì‚¬ìš©í•´ì„œ Stringì„ í•œ ë²ˆ ì•ˆì „í•˜ê²Œ ê°ì‹¸ì¤˜ì•¼ í•œë‹¤.

ì˜ì–´ ì•„ë‹Œ ê°’ìœ¼ë¡œ request í•  ë•ŒëŠ” ê¼­! **addingPercentEncoding í•´ì£¼ê¸°**

ê¼­ responseDecodableë¥¼ ë¶™ì—¬ì£¼ì–´, ë°›ì€ ë°ì´í„°ë¥¼ ìš°ë¦¬ê°€ ë§Œë“  ëª¨ë¸ë¡œ ë””ì½”ë“œ ì‹œì¼œì¤˜ì•¼ ì½ì„ ìˆ˜ ìˆë‹¤.

guard caseë¬¸ì„ ì‚¬ìš©í•´ ì„±ê³µí–ˆì„ ë•Œë§Œ í•´ë‹¹ ë°ì´í„°ë¥¼ ì½ì–´ì„œ stations(Station ë°°ì—´)ë¥¼ ì¶œë ¥í•˜ë„ë¡ í•´ì¤¬ë‹¤.

**ê·¸ë¦¬ê³  ê¼­!! ìŠì§€ë§ê³  resume() ë¶™ì´ê¸°!!!**

<img width="1252" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-23 á„‹á…©á„Œá…¥á†« 11 11 41" src="https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/57b6ac6e-d257-42a3-b186-3f9d5aec325a">


ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰ì‹œì¼œë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì œëŒ€ë¡œ ë°ì´í„°ê°€ ë„ì°©í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ë‹¤ìŒ APIë¥¼ êµ¬í˜„í•´ë³´ì.

ë‹¤ìŒì— êµ¬í˜„í•  APIëŠ” ë°”ë¡œ ì§€í•˜ì² ì—­ì„ ê²€ìƒ‰í•œ ë’¤, ì…€ì„ í´ë¦­í–ˆì„ ë•Œ ë‚˜íƒ€ë‚˜ëŠ” **ì„œìš¸ì‹œ ì§€í•˜ì²  ì‹¤ì‹œê°„ ë„ì°©ì •ë³´**ì´ë‹¤. 

[ì„œìš¸ì‹œ ì§€í•˜ì²  ì‹¤ì‹œê°„ ë„ì°©ì •ë³´](https://data.seoul.go.kr/dataList/OA-12764/F/1/datasetView.do)

response í•˜ëŠ” ê°’ì´ êµ‰ì¥íˆ ë§ì§€ë§Œ ë‹¹ì—°íˆ ì´ ì¤‘ì—ì„œ ê³¨ë¼ ë°ì´í„°ë¥¼ ë½‘ì•„ë‚´ ì¤„ ê²ƒì´ë‹¤.

```swift
//
//  StationArrivalDataResponseModel.swift
//  SubwayNotice
//
//  Created by jinyong yun on 1/23/24.
//

import Foundation

struct StationArrivalDataResponseModel: Decodable {
    
    var realtimeArrivalList: [RealTimeArrival] = []
    
    struct RealTimeArrival: Decodable {
        let line: String // ~í–‰
        let remainTime: String // ë„ì°©ê¹Œì§€ ë‚¨ì€ ì‹œê°„
        let currentStation: String // í˜„ì¬ ìœ„ì¹˜
        
        enum CodingKeys: String, CodingKey {
            case line = "trainLineNm"
            case remainTime = "arvlMsg2"
            case currentStation = "arvlMsg3"
            
        }
    }
}
```

ëª¨ë¸ì€ ì•„ê¹Œë³´ë‹¤ ë”ìš± ê°„ë‹¨í•˜ë‹¤.

ëª¨ë¸ì„ ì™„ì„±í–ˆìœ¼ë©´ StationDetailViewControllerì—ì„œ requestí•˜ëŠ” ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ë³´ì.

ê¸°ì¡´ì— UIRefreshControlì„ ìœ„í•´ ì‘ì„±í–ˆë˜ fetchData() selector ë©”ì„œë“œì— request í•˜ëŠ” ë‚´ìš©ì„ ì‘ì„±í•˜ë ¤ê³  í•œë‹¤. ì•„ê¹Œì™€ ë˜‘ê°™ì€ êµ¬ë¬¸ì´ë‹¤.

```swift
@objc func fetchData(){
       
        //refreshControl.endRefreshing()
        
        let urlString = "http://swopenapi.seoul.go.kr/api/subway/sample/json/realtimeStationArrival/0/5/ì™•ì‹­ë¦¬"
        
        AF.request(urlString.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "")
            .responseDecodable(of: StationArrivalDataResponseModel.self) { resposne in
                guard case .success(let data) = resposne.result else {return}
                
                print(data.realtimeArrivalList)
            }
            .resume()
        
    }
```

í™”ë©´ì— ë°”ë¡œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆê²Œ viewDidLoadì—ì„œë„ fetchDataë¥¼ ë¶ˆëŸ¬ì£¼ê³ 

ì‹œë®¬ë ˆì´í„°ë¥¼ ì‹¤í–‰ì‹œì¼œë³´ë©´
<img width="1250" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-23 á„‹á…©á„Œá…¥á†« 11 27 03" src="https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/544803a8-d08c-46ea-8994-aab1c118858f">



ë‘ ì¢…ë¥˜ì˜ ë°ì´í„°ê°€ ëª¨ë‘ ì˜ ë„ì°©í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ì—¬ê¸°ì„œ ì¡°ê¸ˆ ë¬¸ì œë„ê¹Œ í—·ê°ˆë ¸ë˜ ë¶€ë¶„ì´ ìˆì—ˆëŠ”ë°

ë‘ ë²ˆì§¸ APIì¸ **ì„œìš¸ì‹œ ì§€í•˜ì²  ì‹¤ì‹œê°„ ë„ì°©ì •ë³´**ì—ì„œ íŠ¹ì´í•œ ì ì´ urlì— â€œì„œìš¸ì—­â€ì´ë¼ê³  requestë¥¼ ë³´ë‚´ë©´ ì‹¤íŒ¨í•˜ê³ , â€œì„œìš¸â€ ì´ë ‡ê²Œ ë³´ë‚´ë©´ requestê°€ ì„±ê³µí•œë‹¤.

ê·¸ë˜ì„œ ìœ ì €ê°€ ì„œìš¸ì„ ì¹˜ë˜, ì„œìš¸ì—­ì„ ì¹˜ë˜ ëª¨ë‘ ì„±ê³µí•˜ê²Œ í•˜ê¸° ìœ„í•´

ì—­ ì´ë¦„ì„ ë³€ìˆ˜ë¡œ ë¹¼ì„œ ì¡°ì •í•˜ëŠ” ë‹¨ê³„ê°€ í•„ìš”í•  ê²ƒ ê°™ë‹¤.

```swift
let stationName = "ì„œìš¸ì—­"
let urlString = "http://swopenapi.seoul.go.kr/api/subway/sample/json/realtimeStationArrival/0/5/\(stationName.replacingOccurrences(of: "ì—­", with: ""))" 
```

ì´ë ‡ê²Œ ì„¤ì •í•´ì¤¬ëŠ”ë° 

stationName.replacingOccurrences(of: "ì—­", with: "")

ë¥¼ ì‚¬ìš©í•´ì„œ, ë§Œì•½ ì—­ ì´ë¦„ì— â€œì—­â€ ë‹¨ì–´ê°€ ìˆë‹¤ë©´ ì´ë¥¼ ë¹ˆ ë¬¸ìì—´ë¡œ ëŒ€ì²´í•˜ë„ë¡ í•´ì¤¬ë‹¤.

```swift
@objc private func fetchData(){
       
        //refreshControl.endRefreshing()
        
        let stationName = "ì„œìš¸ì—­"
        let urlString = "http://swopenapi.seoul.go.kr/api/subway/sample/json/realtimeStationArrival/0/5/\(stationName.replacingOccurrences(of: "ì—­", with: ""))"
        
        AF.request(urlString.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "")
            .responseDecodable(of: StationArrivalDataResponseModel.self) { resposne in
                guard case .success(let data) = resposne.result else {return}
                
                print(data.realtimeArrivalList)
            }
            .resume()
        
    }
```

ê·¸ëŸ¼ ì—¬ê¸°ì„œ ìš°ë¦¬ê°€ ì€ê·¼ìŠ¬ì© ì£¼ì„ì²˜ë¦¬í–ˆë˜   //refreshControl.endRefreshing()

ì´ë…€ì„ì˜ ìœ„ì¹˜ëŠ” ëŒ€ì²´ ì–´ë””ì¼ê¹Œ?

ë³´í†µ ì•±ì„ ì‚¬ìš©í•  ë•Œ refreshingì´ ëë‚˜ì•¼ í•˜ëŠ” íƒ€ì´ë°ì€ ì„œë²„ì˜ ìš”ì²­ì´ ì™„ë£Œë˜ê³ , ë·°ë¥¼ ìƒˆë¡œ ê·¸ë ¤ì•¼ í•˜ëŠ” ì‹œì ì´ë‹¤.

ì´ê±¸ ì½”ë“œë¡œ ì‚´í´ë³´ë©´ ë§Œì•½ print(data.realtimeArrivalList) ë’¤ì— endRefreshingì´ ì˜¤ê²Œ ë˜ë©´

ì‹¤íŒ¨í–ˆì„ ë•ŒëŠ” refreshControlì´ ì ˆëŒ€ ë©ˆì¶”ì§€ ì•ŠëŠ”ë‹¤(?!)

í•˜ì§€ë§Œ ì‹¤íŒ¨ì™€ ì„±ê³µì— ìƒê´€ì—†ì´ ì¼ë‹¨ reponseê°€ ì˜¤ë©´ refreshingì´ ì™„ë£Œë˜ëŠ” ê²ƒì„ ì›í•˜ê¸° ë•Œë¬¸ì— 

guard case ë¬¸, ì¦‰ ë¶„ê¸° ì „ì— endRefreshingì„ ì„¤ì •í•´ì¤¬ë‹¤.

```swift
@objc private func fetchData(){
        
        let stationName = "ì„œìš¸ì—­"
        let urlString = "http://swopenapi.seoul.go.kr/api/subway/sample/json/realtimeStationArrival/0/5/\(stationName.replacingOccurrences(of: "ì—­", with: ""))"
        
        AF.request(urlString.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "")
            .responseDecodable(of: StationArrivalDataResponseModel.self) { [weak self] resposne in
                
                self?.refreshControl.endRefreshing()
                
                guard case .success(let data) = resposne.result else {return}
                
                print(data.realtimeArrivalList)
            }
            .resume()
        
    }
```

## ì§€í•˜ì²  ë„ì°© ì •ë³´ ë°ì´í„° í™”ë©´ì— í‘œì‹œí•˜ê¸°

ìë™ ì™„ì„± ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ 

ì„œì¹˜ë°” ì…ë ¥ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” í‚¤ë³´ë“œì˜ ê¸€ì”¨ ì…ë ¥ì„ ë¸ë¦¬ê²Œì´íŠ¸ ë©”ì„œë“œë¡œ ì¸ì‹í•˜ê³  

ë°”ë¡œë°”ë¡œ ì„œë²„ì— requestë¥¼ ìš”ì²­í•˜ëŠ” íƒ€ì´ë°ì„ ì˜ ì¡°ì ˆí•´ ì¤˜ì•¼ í•œë‹¤.

ë˜ í‚¤ë³´ë“œê°€ í•œ ë²ˆ ëˆŒë ¤ì¡Œì„ ë•Œ ì„œë²„ì— ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ í•˜ê³ , ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ response ê°’ì„ ë°”ë¡œë°”ë¡œ í…Œì´ë¸” ë·°ì— í‘œì‹œë¥¼ í•´ì¤˜ì•¼ í•œë‹¤.

```swift
override func viewDidLoad() {
        super.viewDidLoad()
        setNavigationItems()
        setTableViewLayout()
        requestStationName()
    }
```

ìš°ë¦¬ëŠ” ì§€ê¸ˆê¹Œì§€ StationSearchViewControllerì˜ viewDidLoad()ì—ì„œ ë¬´ì¡°ê±´ì ìœ¼ë¡œ 

 requestStationName()ë¥¼ í˜¸ì¶œí•˜ë„ë¡ í–ˆë‹¤.

ì´ë²ˆì—ëŠ” UISearchBarDelegate ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ê¸€ìë¥¼ ë°›ìë§ˆì ì¦‰ ìœ ì €ê°€ í‚¤ë³´ë“œì— ì…ë ¥í•  ë•Œ

API í†µì‹ ì„ ì§„í–‰í•˜ë„ë¡ êµ¬í˜„í•´ë³´ê² ë‹¤.

ìœ ì €ê°€ SearchBarì— í•œê¸€ìì”© ì…ë ¥í–ˆì„ ë•Œ ë¶ˆë ¤ì§€ëŠ” ë©”ì„œë“œê°€ ë°”ë¡œ

UISearchBarDelegateì˜ textDidChange ë©”ì„œë“œì´ë‹¤.

```swift
private func requestStationName(from stationName: String) {
        let urlString = "http://openapi.seoul.go.kr:8088/sample/json/SearchInfoBySubwayNameService/1/5/\(stationName)"
        
        AF.request(urlString.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "")
            .responseDecodable(of: StationResponseModel.self) { response in
                guard case .success(let data) = response.result else {return}
                
                print(data.stations)
            }
            .resume()
        
    }

extension StationSearchViewController: UISearchBarDelegate {
 ...
    
    func searchBar(_ searchBar: UISearchBar, textDidChange searchText: String) {
        requestStationName(from: searchText)
    }
}
```

ê¸°ì¡´ì— ë§Œë“¤ì—ˆë˜ requestStationName ë©”ì„œë“œê°€ ë‹¤ìŒê³¼ ê°™ì´ searchTextë¥¼ ì¸ìë¡œ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•˜ê³ , textDidChange ë©”ì„œë“œ ë‚´ì—ì„œ searchBarì˜ í…ìŠ¤íŠ¸ê°€ ë³€í•  ë•Œë§ˆë‹¤ ì„œë²„ì— í•´ë‹¹ í…ìŠ¤íŠ¸ë¡œ requestë¥¼ ë‚ ë¦´ ìˆ˜ ìˆë„ë¡ í•´ì¤¬ë‹¤.

ìš°ë¦¬ê°€ ì„œë²„ í†µì‹ ì„ í•´ì£¼ê¸´ í–ˆëŠ”ë°, ê·¸ëŸ¼ ì–´ë””ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ëœ ê²ƒì¼ê¹Œ? ìš°ë¦¬ëŠ” ë¶„ëª… ì•ì—ì„œ í´ë¡œì €ë¥¼ ì‚¬ìš©í•´ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í•œë‹¤ê³  í–ˆë‹¤.

```swift
 AF.request(urlString.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "")
            .responseDecodable(of: StationResponseModel.self) { response in
                guard case .success(let data) = response.result else {return}
                
                print(data.stations)
            }
            .resume()
```

ë°”ë¡œ request ì²˜ë¦¬ë¥¼ í•´ì¤¬ë˜ ìœ„ì˜ ë¶€ë¶„ì´ë‹¤. 

ì´ ë¶€ë¶„ì—ì„œ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ê°€ì ¸ì˜¨ ì •ë³´ë“¤ì„ ë°”ë¡œë°”ë¡œ í”„ë¦°íŠ¸ í•˜ëŠ” ê²ƒ ìì²´ê°€ ë²Œì¨ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ êµ¬í˜„ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤!

ìƒê°í•´ë³´ë©´ ì„œë²„ì—ì„œ ê²°ê³¼ê°’ì´ ì˜¤ê³  íŒŒì‹±ì´ ëë‚˜ëŠ” íƒ€ì´ë°ê¹Œì§€ ì•±ì´ êº¼ì ¸ìˆê±°ë‚˜, holding ë˜ì–´ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” ë¬´ì–¸ê°€ê°€ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

ê·¸ë¦¬ê³  ìš°ë¦¬ëŠ” ê·¸ë™ì•ˆ numberOfCellë¡œ ì…€ì˜ ê°œìˆ˜ë¥¼ (ì¡°ì¡í•˜ê²Œ) í•¸ë“¤ë§ í•˜ê³  ìˆì—ˆë‹¤.

ì´ í”„ë¡œí¼í‹°ë¥¼ ì‚­ì œí•˜ê³  ì œëŒ€ë¡œ ëœ stationsë¼ëŠ” Stationì˜ ë°°ì—´ í”„ë¡œí¼í‹°ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

```swift
extension StationSearchViewController: UITableViewDataSource {
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return stations.count
    }
    
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = UITableViewCell(style: .subtitle, reuseIdentifier: "Cell")
        let station = stations[indexPath.row]
        cell.textLabel?.text = station.stationName
        cell.detailTextLabel?.text = station.lineNumber
        
        return cell
    }
    
    
}
```

ì´ì œ ê¸°ì¡´ numberOfCell ìë¦¬ë¥¼ stations ê°€ ì±„ì›Œì£¼ë„ë¡ ìˆ˜ì •í•´ì£¼ë©´ ëœë‹¤.

numberOfRowsInSectionì˜ ë¦¬í„´ê°’ì„ stations ë°°ì—´ì˜ countë¡œ í•´ì£¼ê³ 

cellForRowAtì—ì„œë„ ì œëŒ€ë¡œ ëœ ê°’ì„ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë‹¤.

```swift
private func requestStationName(from stationName: String) {
        let urlString = "http://openapi.seoul.go.kr:8088/sample/json/SearchInfoBySubwayNameService/1/5/\(stationName)"
        
        AF.request(urlString.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "")
            .responseDecodable(of: StationResponseModel.self) { [weak self] response in
                guard let self = self,
                        case .success(let data) = response.result else {return}
                
                self.stations = data.stations
                self.tableView.reloadData()
            }
            .resume()
        
    }
```

requestStationName ë©”ì„œë“œ ì•ˆì—ì„œë„ ë°›ì•„ì˜¨ stations ëª¨ë¸ì„ StationSearchViewControllerì˜ stationsì— ëŒ€ì…í•´ì£¼ê³ , í´ë¡œì € ë‚´ë¶€ì—ì„œ selfë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— ê°•í•œ ì°¸ì¡°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ [weak self]ì™€ self ì˜µì…”ë„ ë°”ì¸ë”©ì„ í•´ì¤€ë‹¤.

![simulator_screenshot_889CFC94-DE86-4C3A-8D79-4D0324D20F13](https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/057747b5-9043-4d3e-a59b-0ce2442a68fe)


ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰ì‹œì¼œì£¼ë©´

ë‹¤ìŒê³¼ ê°™ì´ ì˜ ë‚˜ì˜¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆëŠ”ë° 

ì—¬ê¸°ì„œ í•˜ë‚˜ ë¬¸ì œì ì´ ë³´ì¸ë‹¤.

cancelì„ ëˆŒëŸ¬ì¤¬ì„ ë•Œ ì…ë ¥ê°’ì´ ì´ˆê¸°í™”ê°€ ë˜ì–´ì•¼ í•˜ëŠ”ë°, ë‹¤ì‹œ ì…ë ¥í•˜ë ¤ê³  ë“¤ì–´ê°€ë³´ë©´ í…Œì´ë¸” ë·°ì— ì´ì „ì˜ ê°’ì´ ê·¸ëŒ€ë¡œ ë‚¨ì•„ìˆë‹¤ëŠ” ë¬¸ì œì´ë‹¤.

```swift
func searchBarTextDidEndEditing(_ searchBar: UISearchBar) {
        tableView.isHidden = true
        stations = []
    }
```

ìš°ë¦¬ê°€ ì´ˆë°˜ì— ì‘ì„±í–ˆë˜ searchBarTextDidEndEditingì— ë‹¤ìŒê³¼ ê°™ì´ stationsê°€ ë¹ˆ ë°°ì—´ì´ ë˜ë„ë¡ ì´ˆê¸°í™” í•´ì£¼ë©´ í•´ê²°ëœë‹¤!

ì§€í•˜ì²  ì—­ ìë™ì™„ì„±ì€ ì™„ì„±í–ˆìœ¼ë‹ˆ, ì§€í•˜ì²  ë„ì°© ì •ë³´ ë°ì´í„°ë¥¼ í™”ë©´ì— í‘œì‹œí•´ë³´ë„ë¡ í•˜ì.

ê°€ì¥ ë¨¼ì € í•´ì¤˜ì•¼ í•  ë¶€ë¶„ì´ ê²€ìƒ‰ ê²°ê³¼ê°€ í‘œì‹œë˜ê³ , í•´ë‹¹ ì…€ì„ ì„ íƒí–ˆì„ ë•Œ

ì •ë³´ë¥¼ ì§€í•˜ì²  ë„ì°© ì •ë³´ í™”ë©´ ì¦‰ StationDetailViewControllerì— ë„˜ê²¨ì£¼ëŠ” ë¶€ë¶„ì´ë‹¤.

```swift
final class StationDetailViewController: UIViewController {
    
    private let station: Station
...

init(station: Station) {
        self.station = station
        super.init(nibName: nil, bundle: nil)
    }
```

stationì„ ë‹´ì„ í”„ë¡œí¼í‹°ì™€ init ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

StationSearchViewControllerë¡œ ëŒì•„ê°€ì„œ didSelectRowAtì—ì„œ indexPathì— ë§ëŠ” station ê°’ì„ ë„˜ê²¨ì¤€ë‹¤.

```swift
extension StationSearchViewController: UITableViewDelegate {
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        let station = stations[indexPath.row]
        let vc = StationDetailViewController(station: station)
        navigationController?.pushViewController(vc, animated: true)
    }
    
}
```

StationDetailViewControllerì—ì„œ ê¸°ì¡´ì— ì™•ì‹­ë¦¬ë¡œ ì„ ì–¸í•´ì¤¬ë˜ navigationItem.titleì„ stationNameìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤.

```swift
override func viewDidLoad() {
        super.viewDidLoad()
        
        navigationItem.title = station.stationName
        
        view.addSubview(collectionView)
        collectionView.snp.makeConstraints { $0.edges.equalToSuperview() }
        
        fetchData()
    }
```

![simulator_screenshot_DF56E533-C443-43CD-8AB1-B13A398786B2](https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/b2072496-a088-4e33-93df-22a607fd4672)


ë‹¤ìŒê³¼ ê°™ì´ ì‹œë®¬ë ˆì´ì…˜ì— ì•ˆêµ­ì„ ê²€ìƒ‰í•˜ë©´, ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´í…œì˜ íƒ€ì´í‹€ì´ ì˜ ë‚˜íƒ€ë‚˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

StationDetailViewControllerì˜ fetchData ë©”ì„œë“œì—ì„œë„ ì œëŒ€ë¡œ ëœ ì—­ ì´ë¦„ì„ ìš”ì²­í•  ìˆ˜ ìˆë„ë¡ í•´ë³´ì.

```swift
final class StationDetailViewController: UIViewController {
    
    ...
    
    private var realtimeArrivalList: [StationArrivalDataResponseModel.RealTimeArrival] = []

    ...
    @objc private func fetchData(){
        
        let stationName = station.stationName
        let urlString = "http://swopenapi.seoul.go.kr/api/subway/sample/json/realtimeStationArrival/0/5/\(stationName.replacingOccurrences(of: "ì—­", with: ""))"
        
        AF.request(urlString.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed) ?? "")
            .responseDecodable(of: StationArrivalDataResponseModel.self) { [weak self] resposne in
                
                self?.refreshControl.endRefreshing()
                
                guard case .success(let data) = resposne.result else {return}
                
                self?.realtimeArrivalList = data.realtimeArrivalList
                self?.collectionView.reloadData()
            }
            .resume()
        
    }

...

extension StationDetailViewController: UICollectionViewDataSource {
    
    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {
        return realtimeArrivalList.count
    }
    
    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: "StationDetailCollectionViewCell", for: indexPath) as? StationDetailCollectionViewCell
        
        let realTimeArrival = realtimeArrivalList[indexPath.row]
        cell?.setup(with: realTimeArrival)
        
        return cell ?? UICollectionViewCell()
    }
    
}

```

```swift
func setup(with realTimeArrival: StationArrivalDataResponseModel.RealTimeArrival) {
        layer.cornerRadius = 12.0
        layer.shadowColor = UIColor.black.cgColor
        layer.shadowOpacity = 0.2
        layer.shadowRadius = 10
        
        backgroundColor = .systemBackground
        
        [lineLabel, remainTimeLabel].forEach { addSubview($0) }
        
        lineLabel.snp.makeConstraints {
            $0.leading.equalToSuperview().inset(16.0)
            $0.top.equalToSuperview().inset(16.0)
        }
        
        remainTimeLabel.snp.makeConstraints {
            $0.leading.equalTo(lineLabel)
            $0.top.equalTo(lineLabel.snp.bottom).offset(16.0)
            $0.bottom.equalToSuperview().inset(16.0)
        }
        
        lineLabel.text = realTimeArrival.line
        remainTimeLabel.text = realTimeArrival.remainTime
        
    }
```

 private var realtimeArrivalList: [StationArrivalDataResponseModel.RealTimeArrival] = []
ë¥¼ ë§Œë“¤ì–´ì£¼ê³ , fetchData()ì—ì„œ                 

self?.realtimeArrivalList = data.realtimeArrivalList ë¥¼ í•´ì¤¬ë‹¤. ì¦‰ ì„œë²„ ë°ì´í„°ì˜ realtimeArrivalListê°€ ìš°ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ í”„ë¡œí¼í‹°ì— ë“¤ì–´ê°€ê³ 

í•´ë‹¹ ë¦¬ìŠ¤íŠ¸ì˜ ë°ì´í„°ë¥¼ í™”ë©´ì— ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ DataSource ë˜í•œ ìˆ˜ì •í•´ì¤¬ë‹¤.

## ì‹¤ì œ êµ¬ë™ í™”ë©´



https://github.com/jinyongyun/Subway_Notice_APP/assets/102133961/e2089cc6-62b0-48eb-9d2a-066b17813975

